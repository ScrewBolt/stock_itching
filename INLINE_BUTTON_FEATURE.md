# ğŸ”˜ è­¦å ±é€šçŸ¥å…§åµŒæŒ‰éˆ•åŠŸèƒ½

## ğŸ“‹ åŠŸèƒ½èªªæ˜

**ç‰ˆæœ¬**ï¼šv1.3.0
**æ—¥æœŸ**ï¼š2026-01-29
**æ–°åŠŸèƒ½**ï¼šåƒ¹æ ¼è­¦å ±é€šçŸ¥ä¸­åŠ å…¥ã€Œç§»é™¤è­¦å ±ã€æŒ‰éˆ•

---

## âœ¨ æ–°åŠŸèƒ½ç‰¹è‰²

### ä¸€éµç§»é™¤è­¦å ±

ç•¶åƒ¹æ ¼è­¦å ±è§¸ç™¼æ™‚ï¼Œé€šçŸ¥è¨Šæ¯ä¸­æœƒåŒ…å«ä¸€å€‹ **ğŸ—‘ï¸ ç§»é™¤æ­¤è­¦å ±** æŒ‰éˆ•ï¼Œè®“ç”¨æˆ¶å¯ä»¥ç›´æ¥é»æ“Šç§»é™¤è©²è­¦å ±ï¼Œç„¡éœ€è¨˜ä½è­¦å ± ID æˆ–è¼¸å…¥å‘½ä»¤ã€‚

### ä½¿ç”¨æµç¨‹

```
1. è¨­å®šè­¦å ±
   /add 2330.TW above 600

2. åƒ¹æ ¼é”æ¨™ï¼Œæ”¶åˆ°é€šçŸ¥
   ğŸ”” åƒ¹æ ¼è­¦å ±è§¸ç™¼ï¼

   ğŸ“Š è‚¡ç¥¨ï¼š2330.TW
   ğŸ’° ç•¶å‰åƒ¹æ ¼ï¼šNT$ 610.00
   ğŸ¯ ç›®æ¨™åƒ¹æ ¼ï¼šé«˜æ–¼ NT$ 600.00

   æ¢ä»¶å·²é”æˆï¼Œè«‹æ³¨æ„ï¼

   [ğŸ—‘ï¸ ç§»é™¤æ­¤è­¦å ±]  â† æŒ‰éˆ•

3. é»æ“ŠæŒ‰éˆ•
   â†’ è­¦å ±ç«‹å³ç§»é™¤
   â†’ è¨Šæ¯æ›´æ–°é¡¯ç¤ºã€Œâœ… è­¦å ±å·²ç§»é™¤ã€
   â†’ æŒ‰éˆ•æ¶ˆå¤±
```

---

## ğŸ› ï¸ æŠ€è¡“å¯¦ä½œ

### 1. Inline Keyboard æŒ‰éˆ•

**æª”æ¡ˆ**ï¼š`src/telegram_bot.py`

**æ–°å¢ import**ï¼š
```python
from telegram import InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import CallbackQueryHandler
```

### 2. send_alert æ–¹æ³•å¢å¼·

**è®Šæ›´å‰**ï¼š
```python
await self.application.bot.send_message(
    chat_id=user_id,
    text=message.strip()
)
```

**è®Šæ›´å¾Œ**ï¼š
```python
# å‰µå»ºç§»é™¤æŒ‰éˆ•
keyboard = [
    [
        InlineKeyboardButton(
            "ğŸ—‘ï¸ ç§»é™¤æ­¤è­¦å ±",
            callback_data=f"remove_alert:{alert['id']}"
        )
    ]
]
reply_markup = InlineKeyboardMarkup(keyboard)

await self.application.bot.send_message(
    chat_id=user_id,
    text=message.strip(),
    reply_markup=reply_markup
)
```

### 3. æŒ‰éˆ•å›èª¿è™•ç†å™¨

**æ–°æ–¹æ³•**ï¼š`button_callback()`

```python
async def button_callback(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """è™•ç†æŒ‰éˆ•é»æ“Šå›èª¿"""
    query = update.callback_query
    await query.answer()  # å›æ‡‰æŒ‰éˆ•é»æ“Š

    # è§£æ callback_data
    if callback_data.startswith("remove_alert:"):
        alert_id = callback_data.split(":", 1)[1]

        # ç§»é™¤è­¦å ±
        success = self.alert_manager.remove_alert(user_id, alert_id)

        if success:
            # æ›´æ–°è¨Šæ¯ï¼Œç§»é™¤æŒ‰éˆ•
            await query.edit_message_text(
                text=f"{query.message.text}\n\nâœ… è­¦å ±å·²ç§»é™¤",
                reply_markup=None
            )
```

### 4. è¨»å†Šè™•ç†å™¨

```python
# è¨»å†ŠæŒ‰éˆ•å›èª¿è™•ç†å™¨
self.application.add_handler(CallbackQueryHandler(self.button_callback))
```

---

## ğŸ“Š äº’å‹•æµç¨‹

### æˆåŠŸç§»é™¤

```
[ç”¨æˆ¶æ”¶åˆ°é€šçŸ¥]
ğŸ”” åƒ¹æ ¼è­¦å ±è§¸ç™¼ï¼

ğŸ“Š è‚¡ç¥¨ï¼š2330.TW
ğŸ’° ç•¶å‰åƒ¹æ ¼ï¼šNT$ 610.00
ğŸ¯ ç›®æ¨™åƒ¹æ ¼ï¼šé«˜æ–¼ NT$ 600.00

æ¢ä»¶å·²é”æˆï¼Œè«‹æ³¨æ„ï¼

[ğŸ—‘ï¸ ç§»é™¤æ­¤è­¦å ±]

[ç”¨æˆ¶é»æ“ŠæŒ‰éˆ•]

[è¨Šæ¯æ›´æ–°ç‚º]
ğŸ”” åƒ¹æ ¼è­¦å ±è§¸ç™¼ï¼

ğŸ“Š è‚¡ç¥¨ï¼š2330.TW
ğŸ’° ç•¶å‰åƒ¹æ ¼ï¼šNT$ 610.00
ğŸ¯ ç›®æ¨™åƒ¹æ ¼ï¼šé«˜æ–¼ NT$ 600.00

æ¢ä»¶å·²é”æˆï¼Œè«‹æ³¨æ„ï¼

âœ… è­¦å ±å·²ç§»é™¤
```

### ç§»é™¤å¤±æ•—

å¦‚æœè­¦å ±å·²è¢«å…¶ä»–æ–¹å¼ç§»é™¤æˆ–ç”¨æˆ¶ç„¡æ¬Šé™ï¼š

```
âŒ ç§»é™¤å¤±æ•—ï¼ˆè­¦å ±ä¸å­˜åœ¨æˆ–ç„¡æ¬Šé™ï¼‰
```

---

## ğŸ” Callback Data æ ¼å¼

**æ ¼å¼**ï¼š`remove_alert:{alert_id}`

**ç¯„ä¾‹**ï¼š`remove_alert:a1b2c3d4-e5f6-7890-abcd-ef1234567890`

**è§£æé‚è¼¯**ï¼š
```python
if callback_data.startswith("remove_alert:"):
    alert_id = callback_data.split(":", 1)[1]
```

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### ç«¯åˆ°ç«¯æ¸¬è©¦

1. **è¨­å®šè­¦å ±**ï¼š
   ```
   /add 2330.TW above 100
   ```

2. **ç­‰å¾…è§¸ç™¼**ï¼ˆæˆ–æ‰‹å‹•æ¸¬è©¦ï¼‰ï¼š
   - ç³»çµ±æ¯ 5 åˆ†é˜æª¢æŸ¥ä¸€æ¬¡
   - åƒ¹æ ¼é”æ¨™æ™‚ç™¼é€é€šçŸ¥

3. **æª¢æŸ¥é€šçŸ¥**ï¼š
   - ç¢ºèªè¨Šæ¯ä¸­æœ‰ **ğŸ—‘ï¸ ç§»é™¤æ­¤è­¦å ±** æŒ‰éˆ•

4. **é»æ“ŠæŒ‰éˆ•**ï¼š
   - æŒ‰éˆ•æ‡‰è©²æ¶ˆå¤±
   - è¨Šæ¯æ›´æ–°é¡¯ç¤ºã€Œâœ… è­¦å ±å·²ç§»é™¤ã€

5. **é©—è­‰ç§»é™¤**ï¼š
   ```
   /list
   ```
   ç¢ºèªè­¦å ±å·²ä¸åœ¨åˆ—è¡¨ä¸­

### æ—¥èªŒé©—è­‰

**é æœŸæ—¥èªŒ**ï¼š
```
INFO - æ­£åœ¨ç™¼é€é€šçŸ¥çµ¦ç”¨æˆ¶ 123456789: 2330.TW 610.0
INFO - âœ… é€šçŸ¥ç™¼é€æˆåŠŸ (ç”¨æˆ¶ 123456789)
INFO - æ”¶åˆ°æŒ‰éˆ•é»æ“Š: remove_alert:xxx-xxx (ç”¨æˆ¶ 123456789)
INFO - å˜—è©¦ç§»é™¤è­¦å ±: xxx-xxx
INFO - âœ… è­¦å ±å·²ç§»é™¤: xxx-xxx (ç”¨æˆ¶ 123456789)
```

---

## ğŸ¯ å„ªå‹¢

### ä½¿ç”¨è€…é«”é©—

| åŠŸèƒ½ | èˆŠæ–¹å¼ | æ–°æ–¹å¼ |
|------|--------|--------|
| ç§»é™¤è­¦å ± | `/list` â†’ è¤‡è£½ ID â†’ `/remove <ID>` | é»æ“ŠæŒ‰éˆ• |
| æ­¥é©Ÿæ•¸ | 3 æ­¥ | 1 æ­¥ |
| éŒ¯èª¤é¢¨éšª | å¯èƒ½è¤‡è£½éŒ¯ ID | ç„¡ |
| ä¾¿åˆ©æ€§ | â­â­ | â­â­â­â­â­ |

### å®‰å…¨æ€§

- âœ… ç”¨æˆ¶éš”é›¢ï¼šåªèƒ½ç§»é™¤è‡ªå·±çš„è­¦å ±
- âœ… ID é©—è­‰ï¼šç¢ºèªè­¦å ±å­˜åœ¨ä¸”å±¬æ–¼è©²ç”¨æˆ¶
- âœ… éŒ¯èª¤è™•ç†ï¼šç§»é™¤å¤±æ•—æ™‚çµ¦äºˆæ˜ç¢ºæç¤º

### å¯æ“´å±•æ€§

**æœªä¾†å¯æ–°å¢æ›´å¤šæŒ‰éˆ•**ï¼š
```python
keyboard = [
    [InlineKeyboardButton("ğŸ—‘ï¸ ç§»é™¤", callback_data=f"remove:{id}")],
    [InlineKeyboardButton("ğŸ”• æš«åœ", callback_data=f"pause:{id}")],
    [InlineKeyboardButton("ğŸ“Š æŸ¥çœ‹è©³æƒ…", callback_data=f"detail:{id}")]
]
```

---

## ğŸ”§ ç¶­è­·æŒ‡å—

### æ–°å¢å…¶ä»–æŒ‰éˆ•

**æ­¥é©Ÿ**ï¼š

1. **åœ¨ send_alert ä¸­æ–°å¢æŒ‰éˆ•**ï¼š
   ```python
   keyboard = [
       [InlineKeyboardButton("ğŸ—‘ï¸ ç§»é™¤", callback_data=f"remove:{id}")],
       [InlineKeyboardButton("æ–°åŠŸèƒ½", callback_data=f"action:{id}")]
   ]
   ```

2. **åœ¨ button_callback ä¸­è™•ç†**ï¼š
   ```python
   if callback_data.startswith("action:"):
       # è™•ç†æ–°åŠŸèƒ½
       pass
   ```

### ä¿®æ”¹æŒ‰éˆ•æ–‡å­—

```python
InlineKeyboardButton(
    "ğŸš« åˆªé™¤è­¦å ±",  # ä¿®æ”¹æ–‡å­—
    callback_data=f"remove_alert:{alert['id']}"
)
```

### ä¿®æ”¹æŒ‰éˆ•æ¨£å¼

```python
# å–®è¡Œå¤šå€‹æŒ‰éˆ•
keyboard = [
    [
        InlineKeyboardButton("âœ… ç¢ºèª", callback_data="confirm"),
        InlineKeyboardButton("âŒ å–æ¶ˆ", callback_data="cancel")
    ]
]

# å¤šè¡ŒæŒ‰éˆ•
keyboard = [
    [InlineKeyboardButton("é¸é … 1", callback_data="opt1")],
    [InlineKeyboardButton("é¸é … 2", callback_data="opt2")],
    [InlineKeyboardButton("é¸é … 3", callback_data="opt3")]
]
```

---

## ğŸ“ å·²ä¿®æ”¹æª”æ¡ˆ

1. âœ… `src/telegram_bot.py`
   - æ–°å¢ import: `InlineKeyboardButton`, `InlineKeyboardMarkup`, `CallbackQueryHandler`
   - ä¿®æ”¹ `send_alert()`: åŠ å…¥æŒ‰éˆ•
   - æ–°å¢ `button_callback()`: è™•ç†æŒ‰éˆ•é»æ“Š
   - è¨»å†Š `CallbackQueryHandler`

---

## ğŸš€ ä½¿ç”¨ç¯„ä¾‹

### ç¯„ä¾‹ 1ï¼šæ­£å¸¸æµç¨‹

```
ç”¨æˆ¶: /add AAPL above 150

ç³»çµ±: âœ… ç›£æ§å·²æ–°å¢ï¼
      ğŸ“Š è‚¡ç¥¨ï¼šAAPL
      ...

[åƒ¹æ ¼é”æ¨™]

ç³»çµ±: ğŸ”” åƒ¹æ ¼è­¦å ±è§¸ç™¼ï¼
      ğŸ“Š è‚¡ç¥¨ï¼šAAPL
      ğŸ’° ç•¶å‰åƒ¹æ ¼ï¼š$ 152.50
      ğŸ¯ ç›®æ¨™åƒ¹æ ¼ï¼šé«˜æ–¼ $ 150.00

      [ğŸ—‘ï¸ ç§»é™¤æ­¤è­¦å ±]

ç”¨æˆ¶: [é»æ“ŠæŒ‰éˆ•]

ç³»çµ±: [è¨Šæ¯æ›´æ–°]
      ...
      âœ… è­¦å ±å·²ç§»é™¤
```

### ç¯„ä¾‹ 2ï¼šå¤šå€‹è­¦å ±

```
ç”¨æˆ¶: /add 2330.TW above 600
      /add 2330.TW below 550

[å…©å€‹è­¦å ±éƒ½è§¸ç™¼]

ç³»çµ±: [é€šçŸ¥ 1]
      ğŸ”” 2330.TW é«˜æ–¼ 600
      [ğŸ—‘ï¸ ç§»é™¤æ­¤è­¦å ±]  â† ç§»é™¤é«˜æ–¼ 600 çš„è­¦å ±

      [é€šçŸ¥ 2]
      ğŸ”” 2330.TW ä½æ–¼ 550
      [ğŸ—‘ï¸ ç§»é™¤æ­¤è­¦å ±]  â† ç§»é™¤ä½æ–¼ 550 çš„è­¦å ±

ç”¨æˆ¶: [å¯é¸æ“‡æ€§ç§»é™¤å…¶ä¸­ä¸€å€‹æˆ–å…©å€‹]
```

---

## âœ… ç‹€æ…‹

**ç•¶å‰ç‰ˆæœ¬**ï¼šv1.3.0
**åŠŸèƒ½ç‹€æ…‹**ï¼šâœ… å·²å¯¦ä½œä¸¦éƒ¨ç½²
**æ¸¬è©¦ç‹€æ…‹**ï¼šç­‰å¾…ç”¨æˆ¶æ¸¬è©¦

**å»ºè­°æ¸¬è©¦**ï¼š
1. è¨­å®šä¸€å€‹å®¹æ˜“è§¸ç™¼çš„è­¦å ±
2. ç­‰å¾…é€šçŸ¥
3. é»æ“Šã€Œç§»é™¤æ­¤è­¦å ±ã€æŒ‰éˆ•
4. ç¢ºèªè­¦å ±å·²ç§»é™¤

---

**å¯¦ä½œæ—¥æœŸ**ï¼š2026-01-29
**åŠŸèƒ½å®Œæˆ**ï¼šâœ…
**æ–‡æª”å®Œæˆ**ï¼šâœ…
